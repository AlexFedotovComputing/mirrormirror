# Инструкция для агентов по работе с кириллицей

- Всегда сохраняйте файлы в UTF-8 без BOM. Не меняйте кодировку существующих файлов.
- Не вставляйте кириллицу в код через одноразовые скрипты, прогоняемые через терминал (особенно PowerShell-пайпы `@' ... '@ | py -`): по пути текст может перекодироваться и превратиться в `???`.
- Если нужно программно записать кириллицу (включая `.ipynb`):
  - Используйте Python с явным указанием кодировки: `Path(...).write_text(text, encoding="utf-8")`.
  - Перед запуском Python выставляйте `PYTHONUTF8=1` или `PYTHONIOENCODING=utf-8`.
- Когда скрипт гоните через терминал, избегайте прямых кириллических литералов; формируйте строки через `\uXXXX`-escape (чистый ASCII, не портится по пути).
- Ноутбуки лучше править напрямую в Jupyter/IDE. Если всё же правите `.ipynb` скриптом — используйте `json.dumps(..., ensure_ascii=False, indent=1)` и берите русские строки либо из исходного JSON, либо собирайте через `\uXXXX`-escape.
- Уже появившиеся `???` — это утраченный текст. Переписывайте его нормальным русским или восстанавливайте из резервных копий/прототипов.
- Для самопроверки выводите строки через `.encode('unicode_escape')`: так сразу видно, остались ли битые байты.
- Формулы LaTeX в markdown: используйте `$ ... $` или `$$ ... $$` (или `\\[ ... \\]`) и помните, что в Python-строках обратный слеш надо экранировать (`\\mathbf`, `\\sin`, `\\top`). Если формула не рендерится, проверьте, не потерялись ли слеши по пути.
- В `bundle_orientation.ipynb` теоретическая markdown-ячейка с описанием матрицы отражения — часть документации; не удаляйте и не упрощайте её без необходимости, при изменениях сохраняйте содержание формул.
- Файл `reflection_bundle_pose.md` содержит алгоритм поиска позы пучка по отражённым лучам — не удаляйте его и обновляйте, если меняется логика расчёта.
